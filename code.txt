//VARIABLES PARA LA FUNCION INICIAL
int freq;
String tipo;
String input;
String subInput;
int longitudFuncion;
String funcion;
int comenzar;

//VARIABLES PARA GRAFICAR LAS ONDAS
double d;

//Seno
#define pwm 11
float sine;
int sine_i;


void setup() {
  pinMode(pwm, OUTPUT);
	Serial.begin(9600); // Iniciar el monitor Serial

  //Mostramos al usuario la forma de ingresar la onda y frecuencia que desea
  Serial.println("Ingrese el comando que desea ejecutar, indicando la frecuencia:");
  Serial.println("1. SIN(frecuencia)");
  Serial.println("2. SQUARE(frecuencia)");
  Serial.println("3. RAMP(frecuencia)");
  Serial.println("4. RAMP2(frecuencia)");

  while (Serial.available() == 0) {} // Wait for User to Input Data 
  input = Serial.readString(); //Read the data the user has input
  input.toUpperCase(); //Pasarlo a uppercase en caso de que el usuario haya ingresado en minuscula
  
  longitudFuncion = input.indexOf('('); //Guardar la posicion donde se encuentra el primer parentesis
  funcion = input.substring(0, longitudFuncion); //Cortar el string de input hasta el primer parentesis para obtener el comando
  freq = input.substring((longitudFuncion+1), (input.length()-1)).toInt(); //Cortar el string de input desde despues del parentesis hasta antes del parentesis para obtener la frecuencia 

  Serial.print("La funcion es: ");
  Serial.println(funcion);
  Serial.print("La frecuencia es: ");
  Serial.print(freq);
  Serial.println(" HZ");
  Serial.println("----------------------");
  Serial.println("----------------------");
}

void loop() {
  Serial.println("Cuando desee graficar, ingrese un 1.");
  while (Serial.available() == 0) {} // Wait for User to Input Data
  
  comenzar = Serial.parseInt(); //Read the data the user has input
  if(comenzar==1)
  { 
    if(funcion=="SIN")
    {   
        //ESTA ES UNA FORMA DE GRAFICAR EL SEN
        for (int i = 0; i < 360; i++){
          Serial.println(2.5 + (2.5*sin(DEG_TO_RAD * i * freq)));
        }

        /* for (int i = -180; i <= 180; i+=1){ //Recorremos 360 grados
          sine = sin(i*(3.1415/180.0)); //Convertimos de grados a radianes
          //Como el arduino va solamente entre 0-5V, aca realizamos una correcion
          //A sine le multiplicamos por 255 y le dividimos por 2 para corregir la amplitud de la senal
          //Le sumamos 127 que mas o menos la mitad de 256
          //Sumando 127 + al valor de la senal tenemos la senal aproximadamente entre 2,5 Volts
          sine_i = 127 + int(sine * 255.0/2.0);

          analogWrite(pwm, sine_i);
          Serial.println(sine_i);
          delay(5);
        } */
    }  
    if(funcion=="SQUARE")
    {
      tone(3, freq); // Definir el pin de OUTPUT, y la frecuencia generada
    }
    if(funcion=="RAMP")
    {   
  	  d = 1000 / freq;
      while(funcion=="RAMP")
      {
        for(int i=0;i<20;i++) {
          Serial.print(map(i, 0, 19, 0, 255));
          Serial.print("\n");
          delay(int(d));
        }  
      }
    }
    if(funcion=="RAMP2")
    {
      d = 1000 / freq; 
      while(funcion=="RAMP2")
      {
        for(int i=0;i<10;i++) {
          Serial.print(map(i, 0, 9, 0, 255));
          Serial.print("\n");
          delay(int(d));
        }

        for(int i=9;i>0;i--) {
          Serial.print(map(i, 0, 9, 0, 255));
          Serial.print("\n");
          delay(int(d));
        }
      }
    }
  }
}
